:doctitle: Retrieving Contracts for a Specific Date
:doccode: ods-main-prod-201

:author: NPJ
:authoremail: nicole-anne.paterson-jones@ext.ec.europa.eu
:docdate: July 2024

= Retrieving Contracts for a Specific Date

This query identifies contracts published on *November 4, 2024*, filtered and sorted to meet specific criteria.

== Filters Applied
* *Publication Date*: Limits results to notices published on `2024-11-04`.
* *Currency*: Restricts contracts to those involving transactions in Euros (EUR).
* *Sorting*: Orders results by contract amount in descending order.

=== Key Relationships in the Data Model

==== Notices and Lots
Notices are linked to lots via the following structure:

[source,sparql]
----
?noticeUri a epo:Notice ;
           epo:refersToLot ?lotUri ;
           epo:hasPublicationDate ?publicationDate ;
           epo:hasNoticePublicationNumber ?publicationNumber .
----

==== Contracts and Lots
Contracts are associated with lots and include details like title, conclusion date, and financial offer values:

[source,sparql]
----
?contractUri a epo:Contract ;
             dct:title ?contractTitle ;
             epo:hasContractConclusionDate ?conclusionDate ;
             epo:includesTender [
  a epo:Tender ;
  epo:isSubmittedForLot ?lotUri ;
  epo:hasFinancialOfferValue [
    a epo:MonetaryValue ;
    epo:hasAmountValue ?amount ;
    epo:hasCurrency ?currencyUri
  ]
] .
----

=== Output Details
* *Contract Title*: Provides the title of the contract.
* *Conclusion Date*: Indicates when the contract was finalized.
* *Lot Information*: Connects contracts back to the referenced lots.
* *Financial Information*: Extracts the contract amount and currency.

== Final Query
The original query written in SPARQL is as follows:

[source, sparql]
----
include::../queries/contracts-per-day.sparql[]
----

* https://publications.europa.eu/webapi/rdf/sparql?default-graph-uri=&query=PREFIX+dct%3A+%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX+dc%3A+%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Felements%2F1.1%2F%3E%0D%0APREFIX+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX+epo%3A+%3Chttp%3A%2F%2Fdata.europa.eu%2Fa4g%2Fontology%23%3E%0D%0APREFIX+cccev%3A+%3Chttp%3A%2F%2Fdata.europa.eu%2Fm8g%2F%3E%0D%0APREFIX+dcterms%3A+%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX+xsd%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX+skos%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0A%0D%0ASELECT+%3FcontractTitle+%3FconclusionDate+%3FlotUri+%3Famount+%3Fcurrency%0D%0AWHERE+%7B%0D%0A++FILTER+%28%3FpublicationDate+%3D+%222024-11-04%22%5E%5Exsd%3Adate%29%0D%0A++FILTER+%28%3FcurrencyUri+%3D+%3Chttp%3A%2F%2Fpublications.europa.eu%2Fresource%2Fauthority%2Fcurrency%2FEUR%3E%29%0D%0A++%3FnoticeUri+a+epo%3ANotice+%3B%0D%0A+++++++++++++epo%3ArefersToLot+%3FlotUri+%3B%0D%0A+++++++++++++epo%3AhasPublicationDate+%3FpublicationDate+%3B%0D%0A+++++++++++++epo%3AhasNoticePublicationNumber+%3FpublicationNumber+.%0D%0A++%3FcontractUri+a+epo%3AContract+%3B%0D%0A+++++++++++++++dct%3Atitle+%3FcontractTitle+%3B%0D%0A+++++++++++++++epo%3AhasContractConclusionDate+%3FconclusionDate+%3B%0D%0A+++++++++++++++epo%3AincludesTender+%5B%0D%0A+++++++a+epo%3ATender+%3B%0D%0A+++++++epo%3AisSubmittedForLot+%3FlotUri+%3B%0D%0A+++++++epo%3AhasFinancialOfferValue+%5B%0D%0A+++++++++a+epo%3AMonetaryValue+%3B%0D%0A+++++++++epo%3AhasAmountValue+%3Famount+%3B%0D%0A+++++++++epo%3AhasCurrency+%3FcurrencyUri%0D%0A+++++++%5D%0D%0A+++++%5D+.%0D%0A++%3FcurrencyUri+dc%3Aidentifier+%3Fcurrency+.%0D%0A%7D%0D%0AORDER+BY+DESC%28%3Famount%29%0D%0A&format=text%2Fhtml&timeout=0&debug=on&run=+Run+Query+[Run the query online]

include::ROOT:partial$feedback.adoc[]
